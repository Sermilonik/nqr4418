<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤ - –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="index.html" class="back-button">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <h1>üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤</h1>
            <p class="subtitle">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π –º–æ–¥—É–ª—å</p>
        </header>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalReportsCount">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingReportsCount">0</div>
                <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="processedReportsCount">0</div>
                <div class="stat-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalCodesCount">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–æ–¥–æ–≤</div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="card">
            <h3>–§–∏–ª—å—Ç—Ä—ã –æ—Ç—á–µ—Ç–æ–≤</h3>
            <div class="filters">
                <select id="statusFilter" class="form-select">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="pending">–û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</option>
                    <option value="processed">–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ</option>
                </select>
                
                <select id="contractorFilter" class="form-select">
                    <option value="">–í—Å–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</option>
                </select>
                
                <select id="dateFilter" class="form-select">
                    <option value="">–í—Å–µ –¥–∞—Ç—ã</option>
                    <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                    <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                    <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                </select>
                
                <button id="applyFilters" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <button id="clearFilters" class="btn btn-outline">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h3>–û—Ç—á–µ—Ç—ã –æ—Ç —Å–∫–ª–∞–¥–∞</h3>
                <div>
                    <button id="markAllProcessed" class="btn btn-sm btn-success">‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏</button>
                    <button id="refreshReports" class="btn btn-sm btn-outline">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div id="reportsList" class="reports-list">
                <div class="empty-state">
                    <span class="empty-icon">üìã</span>
                    <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</p>
                    <small>–û—Ç—á–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ</small>
                </div>
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ –æ—Ç—á–µ—Ç–∞ -->
        <div id="reportDetails" class="card hidden">
            <div class="card-header">
                <h3>–î–µ—Ç–∞–ª–∏ –æ—Ç—á–µ—Ç–∞</h3>
                <div>
                    <button id="processReport" class="btn btn-success">‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º</button>
                    <button onclick="closeReportDetailsFallback()" class="btn btn-secondary">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
            
            <div id="reportContent">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ -->
        <div id="accountantNotifications" class="notifications-panel hidden">
            <div class="notifications-header">
                <h4>üìß –ù–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã</h4>
                <button onclick="hideNotificationsFallback()" class="btn btn-sm btn-secondary">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <div id="notificationsList" class="notifications-list">
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è -->
        <div class="sync-actions" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc;">
            <small style="color: #666; display: block; margin-bottom: 8px;">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏:</small>
            <button class="btn btn-sm btn-outline" onclick="exportReportsGlobal()">
                üì§ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
            </button>
            <button class="btn btn-sm btn-outline" onclick="importReportsGlobal()">
                üì• –ò–º–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
            </button>
            <button class="btn btn-sm btn-outline" onclick="syncDataSourcesGlobal()">
                üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button class="btn btn-sm btn-outline" onclick="debugStorageGlobal()">
                üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
            </button>
        </div>

        <!-- –û—Ç–ª–∞–¥–∫–∞ -->
        <div style="margin-top: 10px;">
            <button class="btn btn-sm btn-outline" onclick="showDebugInfo()">
                ‚ÑπÔ∏è –ò–Ω—Ñ–æ —Å–∏—Å—Ç–µ–º—ã
            </button>
            <button class="btn btn-sm btn-outline" onclick="clearMobileConsole()">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å
            </button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <button id="showNotifications" class="notification-bell" onclick="showNotificationsFallback()">
        üîî <span id="notificationCount" class="notification-badge hidden">0</span>
    </button>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="notificationContainer"></div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bwip-js@2.1.2/dist/bwip-js.min.js"></script>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/utils.js"></script>
    <script src="js/app-state.js"></script>
    <script src="js/pdf-generator.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/accountant.js"></script>

    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å -->
    <div id="mobileConsole" style="position: fixed; bottom: 10px; right: 10px; z-index: 10000;">
        <button onclick="toggleMobileConsole()" style="background: #007bff; color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 20px;">
            üêõ
        </button>
        <div id="consolePanel" style="display: none; position: absolute; bottom: 60px; right: 0; width: 320px; height: 300px; background: #1e1e1e; color: #00ff00; border: 2px solid #007bff; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px;">
            <div style="background: #007bff; color: white; padding: 8px; border-radius: 6px 6px 0 0;">
                <strong>–ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å</strong>
                <button onclick="clearMobileConsole()" style="float: right; background: #ff4444; color: white; border: none; border-radius: 4px; padding: 2px 8px;">üßπ</button>
            </div>
            <div id="consoleOutput" style="height: 220px; overflow-y: auto; padding: 10px; border-bottom: 1px solid #333;">
                <!-- –°—é–¥–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è –ª–æ–≥–∏ -->
            </div>
            <div style="padding: 8px;">
                <input type="text" id="consoleInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É..." 
                       style="width: 100%; padding: 8px; border: 1px solid #555; background: #2d2d2d; color: #00ff00; border-radius: 4px; font-family: monospace;"
                       onkeypress="handleConsoleInput(event)">
                <small style="color: #888; display: block; margin-top: 5px;">
                    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã: debug, reports, contractors, storage, clear, help, fix
                </small>
            </div>
        </div>
    </div>
    
    <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    console.log('üîß Checking script loading...');
    console.log('utils.js:', typeof showSuccess !== 'undefined' ? '‚úÖ' : '‚ùå');
    console.log('app-state.js:', typeof AppState !== 'undefined' ? '‚úÖ' : '‚ùå');
    console.log('pdf-generator.js:', typeof PDFGenerator !== 'undefined' ? '‚úÖ' : '‚ùå');
    console.log('notifications.js:', typeof NotificationManager !== 'undefined' ? '‚úÖ' : '‚ùå');
    console.log('accountant.js:', typeof AccountantManager !== 'undefined' ? '‚úÖ' : '‚ùå');

    // –ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å —Å –≤–≤–æ–¥–æ–º –∫–æ–º–∞–Ω–¥
    let consoleVisible = false;
    const consoleOutput = document.getElementById('consoleOutput');
    const consolePanel = document.getElementById('consolePanel');
    const consoleInput = document.getElementById('consoleInput');
    
    function toggleMobileConsole() {
        consoleVisible = !consoleVisible;
        consolePanel.style.display = consoleVisible ? 'block' : 'none';
        if (consoleVisible) {
            setTimeout(() => consoleInput.focus(), 100);
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥
    function handleConsoleInput(event) {
        if (event.key === 'Enter') {
            const command = consoleInput.value.trim();
            consoleInput.value = '';
            
            // –í—ã–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Å–æ–ª—å
            addToConsole(`<span style="color: #ffff00">&gt; ${command}</span>`);
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É
            executeCommand(command);
        }
    }
    
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
    function executeCommand(command) {
        switch(command.toLowerCase()) {
            case 'debug':
            case 'info':
                showDebugInfo();
                break;
            case 'restorecontractors':
                restoreDefaultContractors();
                break;
            case 'clear':
                clearMobileConsole();
                break;
            case 'help':
                showHelp();
                break;
            case 'reports':
                showReportsDebug();
                break;
            case 'contractors':
                showContractorsDebug();
                break;
            case 'storage':
                showStorageDebug();
                break;
            case 'test':
                addToConsole('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!');
                console.log('–¢–µ—Å—Ç –∏–∑ –º–æ–±–∏–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏');
                break;
            case 'fix':
                fixManagers();
                break;
            case 'reset':
                resetData();
                break;
            case 'refreshstats':
                refreshStats();
                break;
            default:
                if (command) {
                    addToConsole(`‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: "${command}"`);
                    addToConsole('üí° –í–≤–µ–¥–∏—Ç–µ "help" –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥');
                }
        }
    }

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    function restoreDefaultContractors() {
        try {
            const defaultContractors = [
                { id: 1, name: '–û–û–û "–†–æ–º–∞—à–∫–∞"', category: '–û–ø—Ç–æ–≤—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å', createdAt: new Date().toISOString() },
                { id: 2, name: '–ò–ü –ò–≤–∞–Ω–æ–≤', category: '–†–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å', createdAt: new Date().toISOString() },
                { id: 3, name: '–û–û–û "–õ—É—á"', category: '–î–∏–ª–µ—Ä', createdAt: new Date().toISOString() },
                { id: 4, name: '–ê–û "–í–µ–∫—Ç–æ—Ä"', category: '–ü–∞—Ä—Ç–Ω–µ—Ä', createdAt: new Date().toISOString() },
                { id: 5, name: '–û–û–û "–õ—É—á –°–∞—è–Ω—ã"', category: '–î–∏–ª–µ—Ä', createdAt: new Date().toISOString() },
                { id: 6, name: '–ê–û "–õ—É—á –í–æ—Å—Ç–æ–∫"', category: '–ü–∞—Ä—Ç–Ω–µ—Ä', createdAt: new Date().toISOString() },
                { id: 7, name: '–ò–ü –õ—É—á–∏—Å—Ç—ã–π', category: '–†–æ–∑–Ω–∏—á–Ω–∞—è —Å–µ—Ç—å', createdAt: new Date().toISOString() }
            ];
            
            localStorage.setItem('honest_sign_contractors', JSON.stringify(defaultContractors));
            
            console.log('‚úÖ Default contractors restored:', defaultContractors);
            addToConsole('‚úÖ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
            addToConsole(`üë• –î–æ–±–∞–≤–ª–µ–Ω–æ ${defaultContractors.length} –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –µ—Å–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
            if (window.accountantManager) {
                accountantManager.loadContractorsFromStorage();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
            showContractorsDebug();
            
        } catch (error) {
            console.error('‚ùå Error restoring contractors:', error);
            addToConsole('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤: ' + error.message);
        }
    }

    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç—á–µ—Ç–∞—Ö (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
    function showReportsDebug() {
        console.log('=== –û–¢–ß–ï–¢–´ –î–ï–ë–ê–ì ===');
    
        try {
            const warehouseReports = JSON.parse(localStorage.getItem('warehouse_reports') || '[]');
            const appStateReports = JSON.parse(localStorage.getItem('honest_sign_reports') || '[]');
            const sentSessions = JSON.parse(localStorage.getItem('honest_sign_sent_sessions') || '[]');
        
            console.log('üìä Warehouse reports:', warehouseReports);
            console.log('üìä AppState reports:', appStateReports);
            console.log('üìä Sent sessions:', sentSessions);
        
            addToConsole(`<strong>üìä –°–≤–æ–¥–∫–∞ –ø–æ –æ—Ç—á–µ—Ç–∞–º:</strong>`);
            addToConsole(`‚Ä¢ Warehouse reports: ${warehouseReports.length}`);
            addToConsole(`‚Ä¢ AppState reports: ${appStateReports.length}`);
            addToConsole(`‚Ä¢ Sent sessions: ${sentSessions.length}`);
            
            // –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            if (warehouseReports.length > 0) {
                addToConsole(`<strong>üìã –î–µ—Ç–∞–ª–∏ –æ—Ç—á–µ—Ç–æ–≤:</strong>`);
                warehouseReports.forEach((report, index) => {
                    addToConsole(`${index + 1}. ID: ${report.id || 'N/A'}`);
                    addToConsole(`   –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: ${report.contractorName || report.contractorId}`);
                    addToConsole(`   –ö–æ–¥—ã: ${report.codes ? report.codes.length : 0}`);
                    addToConsole(`   –°—Ç–∞—Ç—É—Å: ${report.status || 'pending'}`);
                    addToConsole(`   –ü–æ—Ä—è–¥–∫–æ–≤—ã–π ‚Ññ: ${report.sequentialNumber || 'N/A'}`);
                    addToConsole(`---`);
                });
            }
            
        } catch (error) {
            console.error('Reports debug error:', error);
            addToConsole('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–æ–≤: ' + error.message);
        }
    }

    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞—Ö (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
    function showContractorsDebug() {
        console.log('=== –ö–û–ù–¢–†–ê–ì–ï–ù–¢–´ –î–ï–ë–ê–ì ===');
        
        try {
            const contractors = JSON.parse(localStorage.getItem('honest_sign_contractors') || '[]');
            const selectedContractors = JSON.parse(localStorage.getItem('honest_sign_selected_contractors') || '{}');
            
            console.log('üë• Contractors:', contractors);
            console.log('üë• Selected contractors:', selectedContractors);
            
            addToConsole(`<strong>üë• –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ:</strong>`);
            addToConsole(`‚Ä¢ –í—Å–µ–≥–æ: ${contractors.length}`);
            
            if (contractors.length > 0) {
                contractors.forEach(contractor => {
                    addToConsole(`‚Ä¢ ${contractor.name} (ID: ${contractor.id}, –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${contractor.category})`);
                });
            } else {
                addToConsole('‚ùå –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage');
            }
            
            if (selectedContractors.contractorIds) {
                addToConsole(`<strong>üéØ –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã:</strong>`);
                addToConsole(`‚Ä¢ ID: ${selectedContractors.contractorIds.join(', ')}`);
            }
            
        } catch (error) {
            console.error('Contractors debug error:', error);
            addToConsole('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤: ' + error.message);
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    function showStorageDebug() {
        console.log('=== –í–°–ï –•–†–ê–ù–ò–õ–ò–©–ê ===');
        
        addToConsole('<strong>üîç –í—Å–µ –∫–ª—é—á–∏ –≤ localStorage:</strong>');
        
        try {
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                addToConsole(`‚Ä¢ ${key}: ${value.length} chars`);
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
            const importantKeys = [
                'warehouse_reports',
                'honest_sign_reports', 
                'honest_sign_contractors',
                'honest_sign_current_session',
                'honest_sign_selected_contractors',
                'warehouse_notifications'
            ];
            
            addToConsole('<strong>üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:</strong>');
            importantKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        addToConsole(`‚Ä¢ ${key}: ${Array.isArray(parsed) ? parsed.length + ' items' : 'object'}`);
                    } catch {
                        addToConsole(`‚Ä¢ ${key}: string (${value.length} chars)`);
                    }
                } else {
                    addToConsole(`‚Ä¢ ${key}: ‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
            });
            
        } catch (error) {
            addToConsole('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ localStorage: ' + error.message);
        }
    }

    // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
    function resetData() {
        if (confirm('‚ùå –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            try {
                localStorage.removeItem('warehouse_reports');
                localStorage.removeItem('honest_sign_reports');
                localStorage.removeItem('honest_sign_sent_sessions');
                localStorage.removeItem('warehouse_notifications');
                
                addToConsole('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                addToConsole('üîÑ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                
            } catch (error) {
                addToConsole('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }
    }

    // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã
    function fixManagers() {
        console.log('üîß Attempting to fix managers...');
        
        if (!window.accountantManager && window.AccountantManager) {
            try {
                window.accountantManager = new AccountantManager();
                addToConsole('‚úÖ accountantManager —Å–æ–∑–¥–∞–Ω');
            } catch (error) {
                addToConsole('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è accountantManager');
            }
        }
        
        if (!window.scannerManager && window.ScannerManager) {
            try {
                window.scannerManager = new ScannerManager();
                addToConsole('‚úÖ scannerManager —Å–æ–∑–¥–∞–Ω');
            } catch (error) {
                addToConsole('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è scannerManager');
            }
        }
        
        if (!window.appState && window.AppState) {
            try {
                window.appState = new AppState();
                addToConsole('‚úÖ appState —Å–æ–∑–¥–∞–Ω');
            } catch (error) {
                addToConsole('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è appState');
            }
        }
        
        // –û–±–Ω–æ–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        showDebugInfo();
    }

    // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    function refreshStats() {
        if (window.accountantManager && typeof accountantManager.updateStatistics === 'function') {
            accountantManager.updateStatistics();
            addToConsole('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
        } else {
            updateStatisticsFallback();
            addToConsole('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (fallback)');
        }
    }

    // Fallback —Ñ—É–Ω–∫—Ü–∏–∏
    function updateStatisticsFallback() {
        try {
            const reports = JSON.parse(localStorage.getItem('warehouse_reports') || '[]');
            const total = reports.length;
            const pending = reports.filter(r => r.status !== 'processed').length;
            const processed = reports.filter(r => r.status === 'processed').length;
            const totalCodes = reports.reduce((sum, r) => sum + (r.codes ? r.codes.length : 0), 0);
            
            document.getElementById('totalReportsCount').textContent = total;
            document.getElementById('pendingReportsCount').textContent = pending;
            document.getElementById('processedReportsCount').textContent = processed;
            document.getElementById('totalCodesCount').textContent = totalCodes;
            
        } catch (error) {
            console.error('Fallback statistics error:', error);
        }
    }

    function closeReportDetailsFallback() {
        document.getElementById('reportDetails').classList.add('hidden');
    }

    function hideNotificationsFallback() {
        const panel = document.getElementById('accountantNotifications');
        if (panel) panel.classList.add('hidden');
    }

    function showNotificationsFallback() {
        const panel = document.getElementById('accountantNotifications');
        if (panel) panel.classList.remove('hidden');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
    function showHelp() {
        addToConsole('üìã <strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</strong>');
        addToConsole('‚Ä¢ <strong>debug</strong> - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ');
        addToConsole('‚Ä¢ <strong>reports</strong> - –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤');
        addToConsole('‚Ä¢ <strong>contractors</strong> - –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤');
        addToConsole('‚Ä¢ <strong>storage</strong> - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞');
        addToConsole('‚Ä¢ <strong>restorecontractors</strong> - üîÑ –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤');
        addToConsole('‚Ä¢ <strong>clear</strong> - –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å');
        addToConsole('‚Ä¢ <strong>fix</strong> - –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã');
        addToConsole('‚Ä¢ <strong>refreshstats</strong> - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É');
        addToConsole('‚Ä¢ <strong>reset</strong> - ‚ö†Ô∏è –û–ß–ò–°–¢–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï');
        addToConsole('‚Ä¢ <strong>test</strong> - —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞');
        addToConsole('‚Ä¢ <strong>help</strong> - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞');
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
    function addToConsole(message) {
        if (consoleOutput) {
            consoleOutput.innerHTML += `<div style="margin-bottom: 5px; line-height: 1.4;">${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
    }
    
    // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å
    function clearMobileConsole() {
        if (consoleOutput) {
            consoleOutput.innerHTML = '';
        }
    }
    
    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –º–æ–±–∏–ª—å–Ω—É—é –∫–æ–Ω—Å–æ–ª—å
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    
    console.log = function(...args) {
        originalLog.apply(console, args);
        const message = args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ');
        addToConsole(`<span style="color: #00ff00">${message}</span>`);
    };
    
    console.error = function(...args) {
        originalError.apply(console, args);
        const message = args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ');
        addToConsole(`<span style="color: #ff4444">‚ùå ${message}</span>`);
    };
    
    console.warn = function(...args) {
        originalWarn.apply(console, args);
        const message = args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ');
        addToConsole(`<span style="color: #ffaa00">‚ö†Ô∏è ${message}</span>`);
    };
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    window.showDebugInfo = function() {
        console.log('=== –°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===');
        console.log('User Agent:', navigator.userAgent);
        console.log('Screen:', screen.width, 'x', screen.height);
        console.log('Touch supported:', 'ontouchstart' in window);
        console.log('LocalStorage:', !!localStorage);
        console.log('scannerManager:', !!window.scannerManager);
        console.log('accountantManager:', !!window.accountantManager);
        console.log('appState:', !!window.appState);
    };
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    window.exportReportsGlobal = function() {
        if (window.accountantManager && typeof accountantManager.exportReportsData === 'function') {
            accountantManager.exportReportsData();
        } else {
            // –†–µ–∑–µ—Ä–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
            try {
                const reports = JSON.parse(localStorage.getItem('warehouse_reports') || '[]');
                const data = {
                    reports: reports,
                    exportedAt: new Date().toISOString(),
                    device: navigator.userAgent
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `–æ—Ç—á–µ—Ç—ã_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showSuccess(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${reports.length} –æ—Ç—á–µ—Ç–æ–≤ (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥)`);
                
            } catch (error) {
                console.error('Global export error:', error);
                showError('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message);
            }
        }
    };

    window.importReportsGlobal = function() {
        if (window.accountantManager && typeof accountantManager.importReportsData === 'function') {
            accountantManager.importReportsData();
        } else {
            showError('–ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        }
    };

    window.syncDataSourcesGlobal = function() {
        if (window.accountantManager && typeof accountantManager.syncDataSources === 'function') {
            accountantManager.syncDataSources();
        } else {
            showError('–§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞');
        }
    };

    window.debugStorageGlobal = function() {
        if (window.accountantManager && typeof accountantManager.debugStorage === 'function') {
            accountantManager.debugStorage();
        } else {
            showStorageDebug();
            showInfo('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (—Å–º. –∫–æ–Ω—Å–æ–ª—å)');
        }
    };

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ–Ω—Å–æ–ª–∏
    const originalToggle = toggleMobileConsole;
    toggleMobileConsole = function() {
        originalToggle();
        if (consoleVisible) {
            addToConsole('üöÄ –ú–æ–±–∏–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            addToConsole('üí° –í–≤–µ–¥–∏—Ç–µ "help" –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥');
        }
    };

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîß DOM loaded, initializing accountant...');
        
        setTimeout(() => {
            // –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞)
            try {
                window.accountantManager = new AccountantManager();
                console.log('‚úÖ AccountantManager initialized successfully');
                addToConsole('‚úÖ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π –º–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
                console.error('‚ùå Error initializing AccountantManager:', error);
                addToConsole('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message);
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π fallback
                window.accountantManager = {
                    loadReports: function() {
                        console.log('üìä Loading reports (fallback)');
                        updateStatisticsFallback();
                    },
                    updateStatistics: updateStatisticsFallback,
                    closeReportDetails: closeReportDetailsFallback,
                    hideNotifications: hideNotificationsFallback,
                    showNotifications: showNotificationsFallback
                };
                addToConsole('‚úÖ –°–æ–∑–¥–∞–Ω fallback –º–µ–Ω–µ–¥–∂–µ—Ä');
            }
        }, 500);
    });
    </script>
</body>
</html>